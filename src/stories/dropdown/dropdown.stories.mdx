import { useState } from 'react';
import { Meta, Story, Preview, Props } from '@storybook/addon-docs/blocks';
import { withKnobs, text, boolean, number, select, array, object } from '@storybook/addon-knobs';
import styled, { css } from 'styled-components';
import fieldValidation from './flag.png';
import Dropdown from '../../components/Dropdown/Dropdown.component';
import Checkbox from '../../components/Checkbox/Checkbox.component';
import DropdownView from './dropdownView.view';
import { FontAwesomeIcon } from '@fortawesome/react-fontawesome';
import { faCheck } from '@fortawesome/pro-regular-svg-icons/faCheck';
import FluidContainer from '../../components/Grid/Container/FluidContainer.component';
import Row from '../../components/Grid/Row/Row.component';
import Column from '../../components/Grid/Column/Column.component';
import useIsDesktop from '../../hooks/useIsDesktop';

<Meta title="Components|Dropdown" component={Dropdown} />

# Dropdown

The Dropdown can be used to present users with a list of options from which they can choose. On mobile devices the
Manor Dropdown presents a full screen overlay of selectable options when the user interacts with it.

<Story name="Dropdown">
  <DropdownView />
</Story>

## Behaviour
* Clicking/Tapping on the Dropdown causes the list of options to be displayed.
* The currently selected option has a `tick` icon displayed next to in the dropdown list.
* Selecting an item from the Dropdown list causes the list to be hidden and the input text to update to that of the
selected option.

#### Mobile specific
* On focus of the Dropdown, a modal is presented on an overlay with a list of the given options.
* When the modal displaying the options is displayed, tapping on the overlay will dismiss the modal and the current
selection will not update.
* When the modal displaying the options is displayed, tapping on an option will dismiss the modal and the current
selection will update to the selected option.

### Accessibility
* The Dropdown can be focused via the `Tab` key.
* When the Dropdown is focused, the `Up` and `Down` arrow keys can be used to traverse the list of options.
* When a list item is focused, the `Enter` key can be used to select it.
* When the Dropdown is focused, the `Escape` key will dismiss the list of options.

## Dropdown with props
<Props of={Dropdown} />

<Story name="Dropdown with props" decorators={[withKnobs]} parameters={{ docs: { disable: true } }}>
  {() => {
   const options = [
      {
        checkboxId: 'A-2', title: 'Default Item - Title', checkboxDisabled: false, selected: true,
      },
      {
        checkboxId: 'A-3', title: 'First Item - Title', checkboxDisabled: false, selected: false,
      },
      {
        checkboxId: 'A-4', title: 'Second Item - Title', checkboxDisabled: false, selected: false,
      },
      {
        checkboxId: 'A-5', title: 'Third Item - Title', checkboxDisabled: false, selected: false,
      },
    ];
    const desktop = useIsDesktop();
    const [selectedIndex, setSelectedIndex] = useState(options.findIndex((option) => option.selected) || 0);
    const componentPropsId = 'Component Props';
    const tooltipGroupId = 'Tooltip Props';
    const id = text('id', 'dropdown-demo', componentPropsId);
    const label = text('label', 'Example Combo', componentPropsId);
    const validationMessage = text('validationMessage', '', componentPropsId);
    const disabled = boolean('disabled', false, componentPropsId);
    const prefixContent = text('prefix', '', componentPropsId);
    const title = text('title', 'input tooltip', tooltipGroupId);
    const body = text('body', 'this is a tooltip for the input component', tooltipGroupId);
    const screenReaderLabel = text('screenReaderLabel', 'input screenReaderLabel', tooltipGroupId);
    const StyledListItem = styled.li`
      svg {
        position: absolute;
        left: 10px;
        top: 10px;
      }
      ${({ active, desktop }) => (active && !desktop) && css`
        background: #f1f8fb;
        color: #0273b5;
         svg {
          display: none;
         }
      `}
    `;
    return (
      <FluidContainer>
        <Row>
          <Column>
            <div style={{height: '300px'}}></div>
            <Dropdown
              id={id}
              label={label}
              options={options}
              disabled={disabled}
              prefixContent={prefixContent}
              validationMessage={validationMessage}
              tooltip={{
                title,
                body,
                screenReaderLabel,
              }}
              handleClick={(event, index) => { setSelectedIndex(index); }}
              handleFocus={(value) => { console.log(value) }}
              handleBlur={(value) => { console.log(value) }}
            >
              {options.map((option, index) => (
                // eslint-disable-next-line react/no-array-index-key
                <StyledListItem option={option} index={index} key={index} ref={option.ref} role="option" tabIndex={index} active={selectedIndex === index} desktop={desktop} >
                  {option.title}
                </StyledListItem>
              ))}
            </Dropdown>
          </Column>
        </Row>
      </FluidContainer>
    );
  }}
</Story>
