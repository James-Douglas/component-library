import { Meta, Story, Preview, Props } from '@storybook/addon-docs/blocks';
import { withKnobs, text, boolean, number, object } from '@storybook/addon-knobs';
import Combo from '../../components/Combo/Combo.component.js';
import fakeApiData from './jsonPlaceholder';
import FluidContainer from '../../components/Grid/Container/FluidContainer.component';
import Row from '../../components/Grid/Row/Row.component';
import Column from '../../components/Grid/Column/Column.component';

<Meta title="Components|Combo" component={Combo} />

# Combo

The Combo component can be used to display a list of items with can be dynamically updated based on the users input. In Manor,
the `Combo` extends `Input` and as such shares similar functionality.

On mobile, the Combo presents a full screen overlay of containing the input and the options list when the user focuses
the input field.

<Preview>
  <Story name="combo preview" height="250px">
  {() => {
    const apiData = fakeApiData.map((obj) => obj.title);
    return (
       <FluidContainer>
           <Row>
             <Column>
                <Combo
                  label="Example Combo label"
                  apiData={apiData}
                  id="combo-id-first"
                  value="ser"
                  required={false}
                  renderLimit={3}
                  emptyStatePicture={{
                    src: "https://www.comparethemarket.com.au/wp-content/uploads/2019/08/Artboard-1-copy-2@2x.png",
                    srcsets: [{ srcset: "https://www.comparethemarket.com.au/wp-content/uploads/2019/08/Artboard-1-copy-2@2x.png"}],
                    alt: 'alt text',
                    title: 'no results found',
                  }}
                  tooltip={{ title: 'Combo component' }}
                  emptyStateHeading = "Sorry, no results found"
                  emptyStateChildren='Try adjusting your search to find what you are looking for.'
                  helperMessage='Please enter your address in the field above and we will try locate it.'
                  handleChange={(value) => {
                    // eslint-disable-next-line no-console
                    console.log(value)
                  }}
                  handleInput={(value) => {
                    // eslint-disable-next-line no-console
                    console.log(value)
                  }}
                />
            </Column>
          </Row>
       </FluidContainer>
    );
  }}
  </Story>
</Preview>

## Behaviour
* When the input has any content, a clear input button is displayed. When clicked/tapped, the input is cleared.
* When the input length meets or exceeds the given `characterMinimum` (default 3), `apiData` is filtered based on whether it
contains the current value of the input. The first `renderLimit` (default 10) resulting matches is displayed to the user.
* Selecting a displayed option populates the input with the selected value.
* If the list of displayed options is displayed and the combo (or any of it's subcomponents) lose focus, the list is
dismissed.

#### Mobile specific
* On focus of the Combo, a modal is presented on an overlay with an input field and a list container with the
`helperMessage` displayed.
* When the modal displaying the input field and list is displayed, tapping on the overlay will dismiss the modal and the
current value will not update.
* When the input field has content with a length less than `characterMinimum` the list container displays the `helperMessage`
* When the input field has content with a length equal or greater than `characterMinimum` and matches are found
in `apiData`, those matches are displayed (limited to `renderLimit`).
* When the input field has content with a length equal or greater than `characterMinimum` and matches are **not** found
in `apiData`, the `emptyStateHeading` and `emptyStateChildren` are displayed.

### Accessibility
* The combo field can be focused via the `Tab` key.
* The clear button can be focused via the `Tab` key.
* When the clear button has focus, both the `Enter` and `Space` keys can be used to clear the input field.
* When the combo is focused, the `Up` and `Down` arrow keys can be used to traverse the list of options.
* When a list item is focused, the `Enter` key can be used to select it.
* When the combo is focused, the `Escape` key will dismiss the list of options.

### Props
<Props of={Combo} />

<Story name="combo with props" decorators={[withKnobs]} parameters={{ docs: { disable: true } }}>
  {() => {
    const componentPropsId = 'Component Props';
    const tooltipGroupId = 'Tooltip Props';
    const apiData = fakeApiData.map((obj) => obj.title);
    const id = text('id', 'combo-demo', componentPropsId);
    const label = text('label', 'Example Combo', componentPropsId);
    const value = text('value', '', componentPropsId);
    const placeholder = text('placeholder', 'Placeholder', componentPropsId);
    const required = boolean('required', true, componentPropsId);
    const disabled = boolean('disabled', false, componentPropsId);
    const bordered = boolean('bordered', true, componentPropsId);
    const validationMessage = text('validationMessage', '', componentPropsId);
    const prefillValue = text('prefillValue', '', componentPropsId);
    const autoComplete = text('autoComplete', 'off', componentPropsId);
    const prefixContent = text('prefix', '', componentPropsId);
    const suffixContent = text('suffix', '', componentPropsId);
    const renderLimit = number('renderLimit', 10, {}, componentPropsId);
    const characterMinimum = number('characterMinimum', 1, {}, componentPropsId);
    const linkHref = text('linkHref', 'https://www.comparethemarket.com.au/', componentPropsId);
    const linkText = text('linkText', 'Canâ€™t find your address?', componentPropsId)
    const title = text('title', 'input tooltip', tooltipGroupId);
    const body = text('body', 'this is a tooltip for the input component', tooltipGroupId);
    const justifyEnd = boolean('justifyEnd', false, tooltipGroupId);
    const screenReaderLabel = text('screenReaderLabel', 'input screenReaderLabel', tooltipGroupId);
    const helperMessage = text('helperMessage', 'Please start typing', tooltipGroupId);
    return (
      <FluidContainer>
        <Row>
          <Column>
          <div style={{height: '300px'}}></div>
            <Combo
              id={id}
              label={label}
              value={value}
              placeholder={placeholder}
              required={required}
              disabled={disabled}
              bordered={bordered}
              validationMessage={validationMessage}
              prefillValue={prefillValue}
              autoComplete={autoComplete}
              prefixContent={prefixContent}
              suffixContent={suffixContent}
              characterMinimum={characterMinimum}
              renderLimit={renderLimit}
              apiData={apiData}
              linkHref={linkHref}
              linkText={linkText}
              handleChange={(value) => {
                // eslint-disable-next-line no-console
                console.log(value)
              }}
              helperMessage={helperMessage}
              tooltip={{
                title,
                body,
                justifyEnd,
                screenReaderLabel,
              }}
            />
          </Column>
        </Row>
      </FluidContainer>
    );
  }}
</Story>

